generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["multiSchema"]
}

datasource db {
  provider = "postgresql"
  url      = env("RAILWAY_DATABASE_URL")
  schemas  = ["caixa", "estoque", "financeiro", "franquias", "metas", "public"]
}

model User {
  id        Int      @id @default(autoincrement())
  name      String
  email     String   @unique
  password  String
  role      String   @default("user")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@schema("public")
}

model Loja {
  id                   Int                    @id @default(autoincrement())
  nome                 String
  meta_venda           Decimal                @db.Decimal(10, 2)
  meta_consumo_limpeza Decimal                @db.Decimal(10, 2)
  porcentagem_comissao Decimal                @db.Decimal(5, 2)
  movimentacoes        Movimentacao[]
  vendas               Venda[]
  itens                ItemEstoque[]
  lancamentos          LancamentoFinanceiro[]
  metas                Meta[]

  @@schema("franquias")
}

model Movimentacao {
  id        Int                   @id @default(autoincrement())
  loja_id   Int
  tipo      TipoMovimentacao
  categoria CategoriaMovimentacao
  valor     Decimal               @db.Decimal(10, 2)
  data      DateTime              @default(now())
  loja      Loja                  @relation(fields: [loja_id], references: [id])

  @@schema("caixa")
}

model Venda {
  id          Int      @id @default(autoincrement())
  loja_id     Int
  numero      String
  dataEmissao DateTime
  valor       Decimal  @db.Decimal(10, 2)
  categoria   String?
  createdAt   DateTime @default(now())
  loja        Loja     @relation(fields: [loja_id], references: [id])

  @@schema("caixa")
}

model Meta {
  id        Int      @id @default(autoincrement())
  loja_id   Int
  nome      String
  meta      Decimal  @db.Decimal(10, 2)
  realizado Decimal  @default(0) @db.Decimal(10, 2)
  periodo   String
  updatedAt DateTime @updatedAt
  loja      Loja     @relation(fields: [loja_id], references: [id])

  @@schema("metas")
}

model ItemEstoque {
  id         Int      @id @default(autoincrement())
  loja_id    Int
  nome       String
  categoria  String
  quantidade Int      @default(0)
  unidade    String
  updatedAt  DateTime @default(now()) @updatedAt @db.Timestamptz(6)
  loja       Loja     @relation(fields: [loja_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@schema("estoque")
}

model LancamentoFinanceiro {
  id        Int      @id @default(autoincrement())
  loja_id   Int
  tipo      String
  categoria String
  valor     Decimal  @db.Decimal(10, 2)
  data      DateTime @default(now()) @db.Timestamptz(6)
  descricao String?
  createdAt DateTime @default(now()) @db.Timestamptz(6)
  loja      Loja     @relation(fields: [loja_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@schema("financeiro")
}

enum TipoMovimentacao {
  entrada
  saida

  @@schema("caixa")
}

enum CategoriaMovimentacao {
  alimento
  limpeza
  venda
  fixo

  @@schema("caixa")
}
